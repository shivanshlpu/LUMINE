<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumine - Temple Management System</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Laila:wght@400;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        saffron: {
                            50: '#fffbeb',
                            100: '#fef3c7',
                            400: '#fbbf24',
                            500: '#f59e0b',
                            600: '#d97706', // Primary Brand Color
                            700: '#b45309',
                            800: '#92400e',
                        },
                        sand: '#fdfbf7', // Page Background
                    },
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                        serif: ['Laila', 'serif'],
                    },
                    backgroundImage: {
                        'mandala': "url('data:image/svg+xml,%3Csvg width=\"60\" height=\"60\" viewBox=\"0 0 60 60\" xmlns=\"http://www.w3.org/2000/svg\"%3E%3Cg fill=\"none\" fill-rule=\"evenodd\"%3E%3Cg fill=\"%23d97706\" fill-opacity=\"0.05\"%3E%3Cpath d=\"M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')",
                    }
                }
            }
        }
    </script>

    <style>
        /* UI consistency ke liye CSS maintain rakha gaya hai */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #fffbeb; }
        ::-webkit-scrollbar-thumb { background: #d97706; border-radius: 4px; }
        .role-content { transition: all 0.3s ease-in-out; }
        input:focus { outline: none; border-color: #d97706; box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.2); }
        
        /* Shake animation for error state (used in JS) */
        @keyframes shake { 
            0%, 100% { transform: translateX(0); } 
            10%, 30%, 50%, 70%, 90% { transform: translateX(-4px); } 
            20%, 40%, 60%, 80% { transform: translateX(4px); } 
        }
    </style>
</head>
<body class="bg-sand font-sans text-gray-800 min-h-screen flex flex-col bg-mandala">

    <header class="w-full bg-white/80 backdrop-blur-md sticky top-0 z-50 border-b border-saffron-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-saffron-600 rounded-lg flex items-center justify-center text-white shadow-lg shadow-saffron-500/30">
                    <i class="ph-fill ph-church text-2xl"></i>
                </div>
                <div>
                    <h1 class="font-serif font-bold text-xl text-saffron-800 leading-tight">Lumine</h1>
                    <p class="text-[10px] uppercase tracking-wider text-gray-500 font-medium">Somnath Temple</p>
                </div>
            </div>

            <div class="flex bg-saffron-50 rounded-full p-1 border border-saffron-200">
                <button id="btn-en" onclick="setLanguage('en')" class="px-3 py-1 rounded-full text-xs font-semibold bg-saffron-600 text-white shadow-sm transition-all">EN</button>
                <button id="btn-hi" onclick="setLanguage('hi')" class="px-3 py-1 rounded-full text-xs font-semibold text-saffron-700 hover:bg-saffron-100 transition-all">HI</button>
            </div>
        </div>
    </header>

    <main class="flex-grow flex items-center justify-center p-4 lg:p-8">
        <div class="max-w-7xl w-full grid lg:grid-cols-2 gap-12 lg:gap-24 items-center">
            
            <div class="hidden lg:block space-y-8 animate-fade-in-up">
                <div class="space-y-4">
                    <span class="inline-block px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm font-medium border border-orange-200">
                        ✨ Jai Shree Ram 
                    </span>
                    <h1 class="font-serif text-5xl xl:text-6xl font-bold text-gray-900 leading-tight">
                        <span data-key="welcomeMain">Welcome —</span> <br>
                        <span class="text-saffron-600" data-key="welcomeSub">स्वागत है</span>
                    </h1>
                </div>

                <div class="grid grid-cols-2 gap-6">
                    <div class="flex items-start gap-3 p-4 bg-white rounded-xl border border-saffron-50 shadow-sm">
                        <div class="p-2 bg-saffron-100 rounded-lg text-saffron-600">
                            <i class="ph-duotone ph-hands-praying text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800" data-key="card1Title">Devotee Services</h3>
                            <p class="text-sm text-gray-500" data-key="card1Desc">Book poojas & donate instantly.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3 p-4 bg-white rounded-xl border border-saffron-50 shadow-sm">
                        <div class="p-2 bg-saffron-100 rounded-lg text-saffron-600">
                            <i class="ph-duotone ph-shield-check text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800" data-key="card2Title">Secure Access</h3>
                            <p class="text-sm text-gray-500" data-key="card2Desc">Role-based gates for staff.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="w-full max-w-md mx-auto lg:mx-0">
                <div class="lg:hidden text-center mb-8 space-y-2">
                    <h1 class="font-serif text-3xl font-bold text-gray-900">
                        <span data-key="welcomeMain">Welcome —</span> <span class="text-saffron-600" data-key="welcomeSub">स्वागत है</span>
                    </h1>
                </div>

                <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden relative">
                    <div id="loadingOverlay" class="absolute inset-0 bg-white/90 backdrop-blur-sm z-20 flex flex-col items-center justify-center hidden">
                        <div class="animate-spin rounded-full h-10 w-10 border-4 border-saffron-100 border-t-saffron-600"></div>
                        <p class="mt-3 text-sm text-saffron-800 font-medium animate-pulse">Verifying credentials...</p>
                    </div>

                    <div class="bg-saffron-50 p-1 m-2 rounded-xl flex justify-between gap-1 overflow-x-auto" id="roleSelector">
                    </div>

                    <div class="p-6 md:p-8 pt-4">
                        <div class="mb-6">
                            <h2 class="text-2xl font-serif font-bold text-gray-900" id="loginTitle" data-key="signIn">Sign In</h2>
                            <p class="text-sm text-gray-500 mt-1 transition-opacity duration-300" id="loginHelper">Login to continue.</p>
                        </div>

                        <form id="loginForm" class="space-y-5" novalidate>
                            <div class="space-y-1">
                                <label for="userId" class="block text-xs font-semibold text-gray-700 uppercase tracking-wide" data-key="labelUserId">User ID / Email</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                                        <i class="ph ph-user text-lg"></i>
                                    </div>
                                    <input type="text" id="userId" name="user_id" required 
                                        class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-400 focus:ring-saffron-500 focus:border-saffron-500 sm:text-sm transition-colors"
                                        placeholder="Enter your ID">
                                </div>
                                <p class="text-red-500 text-xs hidden" id="userIdError">Please enter a valid ID.</p>
                            </div>

                            <div class="space-y-1">
                                <label for="password" class="block text-xs font-semibold text-gray-700 uppercase tracking-wide" data-key="labelPassword">Password</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                                        <i class="ph ph-lock-key text-lg"></i>
                                    </div>
                                    <input type="password" id="password" name="password" required minlength="8"
                                        class="block w-full pl-10 pr-10 py-3 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-400 focus:ring-saffron-500 focus:border-saffron-500 sm:text-sm transition-colors"
                                        placeholder="••••••••">
                                    <button type="button" id="togglePass" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 cursor-pointer">
                                        <i class="ph ph-eye-slash text-lg"></i>
                                    </button>
                                </div>
                                <p class="text-red-500 text-xs hidden" id="passwordError">Password is required.</p>
                            </div>

                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <input id="remember-me" name="remember-me" type="checkbox" class="h-4 w-4 text-saffron-600 focus:ring-saffron-500 border-gray-300 rounded cursor-pointer">
                                    <label for="remember-me" class="ml-2 block text-sm text-gray-600 cursor-pointer select-none" data-key="rememberMe">Remember me</label>
                                </div>
                                <div class="text-sm">
                                    <a href="#" class="font-medium text-saffron-600 hover:text-saffron-500 hover:underline" data-key="forgotPass">Forgot password?</a>
                                </div>
                            </div>

                            <div id="globalError" class="hidden p-3 bg-red-50 border border-red-100 rounded-lg flex items-center gap-2 text-red-600 text-sm">
                                <i class="ph-fill ph-warning-circle text-lg"></i>
                                <span id="globalErrorText">Something went wrong.</span>
                            </div>

                            <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-semibold text-white bg-saffron-600 hover:bg-saffron-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-saffron-500 transition-transform transform active:scale-95" data-key="loginBtn">
                                Secure Login
                            </button>
                        </form>
                    </div>

                    <div class="bg-gray-50 px-6 py-4 border-t border-gray-100 text-center">
                        <p class="text-xs text-gray-500">
                            <span data-key="newHere">New here?</span> <a href="#" class="font-medium text-saffron-600 hover:text-saffron-500" data-key="registerLink">Register as Devotee</a>
                        </p>
                    </div>
                </div>
                
                <div class="mt-6 text-center text-xs text-gray-400 flex items-center justify-center gap-1">
                    <i class="ph-fill ph-lock-key"></i>
                    <span>256-bit SSL Encrypted Connection</span>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-white border-t border-gray-200 py-6 mt-8">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-sm text-gray-500 font-serif">© 2024 Lumine Temple Management. Om Namah Shivay.</p>
        </div>
    </footer>

    <script>
        // --- Translations ---
        const TRANSLATIONS = {
            en: {
                welcomeMain: "Welcome —",
                welcomeSub: "स्वागत है",
                heroSubtitle: "Seva, Darshan & Management — one dashboard for the entire mandir ecosystem.",
                card1Title: "Devotee Services",
                card1Desc: "Book poojas & donate instantly.",
                card2Title: "Secure Access",
                card2Desc: "Role-based gates for staff.",
                signIn: "Sign In",
                labelUserId: "User ID / Email",
                labelPassword: "Password",
                rememberMe: "Remember me",
                forgotPass: "Forgot password?",
                loginBtn: "Secure Login",
                newHere: "New here?",
                registerLink: "Register as Devotee"
            },
            hi: {
                welcomeMain: "स्वागत है —",
                welcomeSub: "Welcome",
                heroSubtitle: "सेवा, दर्शन और प्रबंधन — पूरे मंदिर पारिस्थितिकी तंत्र के लिए एक डैशबोर्ड।",
                card1Title: "भक्त सेवाएँ",
                card1Desc: "पूजा बुक करें और तुरंत दान करें।",
                card2Title: "सुरक्षित प्रवेश",
                card2Desc: "कर्मचारियों के लिए भूमिका-आधारित लॉगिन।",
                signIn: "लॉग इन करें",
                labelUserId: "यूज़र आईडी / ईमेल",
                labelPassword: "पासवर्ड",
                rememberMe: "मुझे याद रखें",
                forgotPass: "पासवर्ड भूल गए?",
                loginBtn: "सुरक्षित लॉगिन",
                newHere: "नए हैं?",
                registerLink: "भक्त के रूप में पंजीकरण करें"
            }
        };

        const ROLES = {
            devotee: {
                id: 'devotee',
                icon: 'ph-hands-praying',
                redirect: 'dashboard.html', 
                en: { label: 'Devotee', helper: "Login with phone or email to book darshan slot.", placeholder: "Phone number or Email" },
                hi: { label: 'भक्त', helper: "सेवा बुक के लिए फोन या ईमेल से लॉगिन करें।", placeholder: "फ़ोन नंबर या ईमेल" }
            },
            mandir_admin: {
                id: 'mandir_admin',
                icon: 'ph-crown',
                redirect: 'admindashboard.html',
                en: { label: 'Admin', helper: "Admin login for temple operations and reports.", placeholder: "Admin Username" },
                hi: { label: 'प्रशासक', helper: "मंदिर संचालन और रिपोर्ट के लिए एडमिन लॉगिन।", placeholder: "एडमिन यूज़रनेम" }
            },
            security_guard: {
                id: 'security_guard',
                icon: 'ph-shield-star',
                redirect: 'security.html',
                en: { label: 'Security', helper: "Badge ID login for entry/exit logs and gate controls.", placeholder: "Badge ID (e.g. SEC-001)" },
                hi: { label: 'सुरक्षा', helper: "प्रवेश/निकास लॉग और गेट नियंत्रण के लिए बैज आईडी लॉगिन।", placeholder: "बैज आईडी (जैसे SEC-001)" }
            },
            parking_incharge: {
                id: 'parking_incharge',
                icon: 'ph-car',
                redirect: 'parking.html',
                en: { label: 'Parking', helper: "Login to manage parking slots and vehicle entries.", placeholder: "Employee ID" },
                hi: { label: 'पार्किंग', helper: "पार्किंग स्लॉट और वाहन प्रविष्टियों को प्रबंधित करने के लिए लॉगिन करें।", placeholder: "कर्मचारी आईडी" }
            }
        };

        let currentRole = 'devotee';
        let currentLang = 'en';

        // --- DOM Elements ---
        const roleSelector = document.getElementById('roleSelector');
        const loginForm = document.getElementById('loginForm');
        const userIdInput = document.getElementById('userId');
        const loginHelper = document.getElementById('loginHelper');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const globalError = document.getElementById('globalError');
        const globalErrorText = document.getElementById('globalErrorText');
        const passwordInput = document.getElementById('password');
        const togglePassBtn = document.getElementById('togglePass');
        const btnEn = document.getElementById('btn-en');
        const btnHi = document.getElementById('btn-hi');

        // --- Initialization ---
        function init() {
            setLanguage('en'); 
            setupEventListeners();
        }

        // --- Language Logic ---
        window.setLanguage = (lang) => {
            currentLang = lang;
            
            // Toggle Button Styles
            if (lang === 'en') {
                btnEn.className = "px-3 py-1 rounded-full text-xs font-semibold bg-saffron-600 text-white shadow-sm transition-all";
                btnHi.className = "px-3 py-1 rounded-full text-xs font-semibold text-saffron-700 hover:bg-saffron-100 transition-all";
            } else {
                btnHi.className = "px-3 py-1 rounded-full text-xs font-semibold bg-saffron-600 text-white shadow-sm transition-all";
                btnEn.className = "px-3 py-1 rounded-full text-xs font-semibold text-saffron-700 hover:bg-saffron-100 transition-all";
            }

            // Update Static Text
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if (TRANSLATIONS[lang][key]) {
                    el.textContent = TRANSLATIONS[lang][key];
                }
            });

            // Re-render Roles and Update Inputs
            renderRoleSelector();
            updateUIForRole(currentRole);
        };

        // --- Render Functions ---
        function renderRoleSelector() {
            roleSelector.innerHTML = Object.values(ROLES).map(role => `
                <button 
                    type="button"
                    onclick="switchRole('${role.id}')"
                    class="role-btn flex-1 flex flex-col items-center justify-center py-2 px-1 rounded-lg text-xs font-medium transition-all duration-200 ${role.id === currentRole ? 'bg-white text-saffron-700 shadow-sm ring-1 ring-black/5' : 'text-gray-500 hover:bg-white/50 hover:text-gray-700'}"
                    data-role="${role.id}"
                >
                    <i class="ph-fill ${role.icon} text-lg mb-0.5"></i>
                    <span>${role[currentLang].label}</span>
                </button>
            `).join('');
        }

        // --- Interaction Logic ---
        window.switchRole = (roleId) => {
            currentRole = roleId;
            renderRoleSelector(); // Re-render to update active state visually
            updateUIForRole(roleId);
        };

        function updateUIForRole(roleId) {
            const roleData = ROLES[roleId];
            
            // Animate text change
            loginHelper.style.opacity = '0';
            setTimeout(() => {
                loginHelper.textContent = roleData[currentLang].helper;
                userIdInput.placeholder = roleData[currentLang].placeholder;
                loginHelper.style.opacity = '1';
            }, 150);

            hideError();
        }

        function setupEventListeners() {
            togglePassBtn.addEventListener('click', () => {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                togglePassBtn.innerHTML = type === 'password' 
                    ? '<i class="ph ph-eye-slash text-lg"></i>' 
                    : '<i class="ph ph-eye text-lg text-saffron-600"></i>';
            });

            loginForm.addEventListener('submit', handleLogin);

            [userIdInput, passwordInput].forEach(input => {
                input.addEventListener('input', () => {
                    input.parentElement.nextElementSibling.classList.add('hidden');
                    input.classList.remove('border-red-500', 'focus:ring-red-500');
                    input.classList.add('border-gray-300', 'focus:ring-saffron-500');
                });
            });
        }

        // --- REAL + MOCK API LOGIC ---
        async function handleLogin(e) {
            e.preventDefault();
            let isValid = true;
            const uid = userIdInput.value.trim();
            const pass = passwordInput.value;

            // Simple client-side validation messages
            const errId = currentLang === 'en' ? "User ID is required." : "यूज़र आईडी आवश्यक है।";
            const errPass = currentLang === 'en' ? "Password must be at least 8 chars." : "पासवर्ड कम से कम 8 अक्षर का होना चाहिए।";

            if (!uid) { showInputError(userIdInput, errId); isValid = false; }
            if (!pass) { showInputError(passwordInput, errPass); isValid = false; }

            if (!isValid) return;

            // --- HARDCODED CREDENTIALS CHECK (For Demo) ---
            
            // 1. Check for Mandir Admin
            if (currentRole === 'mandir_admin' && uid === 'admin' && pass === 'admin123') {
                loadingOverlay.classList.remove('hidden');
                setTimeout(() => {
                    handleSuccess({ token: 'mock-admin-token', redirectUrl: 'admindashboard.html' });
                    loadingOverlay.classList.add('hidden');
                }, 1000); // Fake API Delay
                return;
            }

            // 2. Check for Devotee
            if (currentRole === 'devotee' && uid === 'shiva900' && pass === 'shivansh') {
                loadingOverlay.classList.remove('hidden');
                setTimeout(() => {
                    handleSuccess({ token: 'mock-devotee-token', redirectUrl: 'dashboard.html' });
                    loadingOverlay.classList.add('hidden');
                }, 1000); // Fake API Delay
                return;
            }

            // --- FALLBACK TO REAL API (If credentials don't match hardcoded ones) ---
            loadingOverlay.classList.remove('hidden');
            hideError();

            const payload = { user_id: uid, password: pass, role: currentRole };

            try {
                // Call Backend (server.js)
                const response = await fetch('http://localhost:5000/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();

                if (response.ok) {
                    handleSuccess(data);
                } else {
                    throw { status: response.status, message: data.error };
                }
            } catch (error) {
                // If it was a hardcoded attempt that failed (wrong password), it will fall here too if API fails
                handleError(error);
            } finally {
                loadingOverlay.classList.add('hidden');
            }
        }

        function handleSuccess(data) {
            if (document.getElementById('remember-me').checked) localStorage.setItem('lumine_token', data.token);
            else sessionStorage.setItem('lumine_token', data.token);

            const btn = loginForm.querySelector('button[type="submit"]');
            btn.innerHTML = `<i class="ph-bold ph-check-circle animate-bounce"></i> Success`;
            btn.classList.replace('bg-saffron-600', 'bg-green-600');
            
            // Redirect using the redirectUrl provided (either from mock or API)
            setTimeout(() => {
                window.location.href = data.redirectUrl; 
            }, 1000);
        }

        function handleError(error) {
            let msg = error.message || "Invalid Credentials or Server Offline.";
            
            globalErrorText.textContent = msg;
            globalError.classList.remove('hidden');
            const card = document.querySelector('.bg-white.rounded-2xl');
            card.classList.add('animate-[shake_0.5s_ease-in-out]');
            setTimeout(() => card.classList.remove('animate-[shake_0.5s_ease-in-out]'), 500);
        }

        function showInputError(input, msg) {
            const errorP = input.parentElement.nextElementSibling;
            errorP.textContent = msg;
            errorP.classList.remove('hidden');
            input.classList.remove('border-gray-300', 'focus:ring-saffron-500');
            input.classList.add('border-red-500', 'focus:ring-red-500');
        }

        function hideError() { globalError.classList.add('hidden'); }

        const styleSheet = document.createElement("style");
        styleSheet.innerText = `@keyframes shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-4px); } 20%, 40%, 60%, 80% { transform: translateX(4px); } }`;
        document.head.appendChild(styleSheet);

        init();
    </script>
</body>
</html>