<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Slot - LUMINE</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <link href="https://fonts.googleapis.com/css2?family=Laila:wght@700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* --- LUMINE DESIGN SYSTEM --- */
        body { background-color: #fdfbf7; font-family: 'Poppins', sans-serif; color: #012a4a; }
        
        /* Inputs */
        .lumine-input {
            width: 100%; padding: 0.8rem; border-radius: 12px; border: 1px solid #e2e8f0;
            background: white; outline: none; transition: all 0.2s; font-size: 0.95rem;
        }
        .lumine-input:focus { border-color: #d97706; box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.1); }
        .lumine-input:disabled { background-color: #f8fafc; cursor: not-allowed; }

        /* Loader Animation */
        .loader-spin { animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Step Wizard */
        .step-circle { transition: all 0.3s ease; }
        .step-active .step-circle { background-color: #d97706; color: white; border-color: #d97706; transform: scale(1.1); box-shadow: 0 4px 10px rgba(217, 119, 6, 0.3); }
        .step-completed .step-circle { background-color: #16a34a; color: white; border-color: #16a34a; }
        
        /* Slide Animation */
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-slide-up { animation: slideUp 0.4s ease-out forwards; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <header class="bg-white/90 backdrop-blur-md shadow-sm border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-3xl mx-auto px-4 h-16 flex items-center justify-between">
            <a href="dashboard.html" class="flex items-center gap-2 text-gray-500 hover:text-orange-600 transition p-2 rounded-lg hover:bg-orange-50">
                <i data-lucide="arrow-left" class="w-5 h-5"></i> <span class="font-bold text-sm">Dashboard</span>
            </a>
            <div class="flex items-center gap-2">
                <span class="text-xl">üïâÔ∏è</span>
                <span class="font-serif font-bold text-navy-900 text-lg">LUMINE Slot-Booking</span>
            </div>
            <div class="w-20"></div> 
        </div>
    </header>

    <main class="flex-grow w-full max-w-3xl mx-auto p-4 md:p-8">
        
        <div class="mb-10 relative px-6">
            <div class="absolute top-5 left-10 right-10 h-1 bg-gray-200 -z-10 rounded-full"></div>
            <div id="progressBar" class="absolute top-5 left-10 h-1 bg-orange-600 -z-10 rounded-full transition-all duration-500" style="width: 0%"></div>
            
            <div class="flex justify-between w-full">
                <div class="step-item step-active flex flex-col items-center gap-2">
                    <div class="step-circle w-10 h-10 rounded-full border-4 border-gray-100 bg-white flex items-center justify-center font-bold text-sm text-gray-500 z-10">1</div>
                    <span class="text-[10px] font-bold uppercase text-gray-500 tracking-wider">Date & Time</span>
                </div>
                <div class="step-item flex flex-col items-center gap-2">
                    <div class="step-circle w-10 h-10 rounded-full border-4 border-gray-100 bg-white flex items-center justify-center font-bold text-sm text-gray-500 z-10">2</div>
                    <span class="text-[10px] font-bold uppercase text-gray-500 tracking-wider">Members</span>
                </div>
                <div class="step-item flex flex-col items-center gap-2">
                    <div class="step-circle w-10 h-10 rounded-full border-4 border-gray-100 bg-white flex items-center justify-center font-bold text-sm text-gray-500 z-10">3</div>
                    <span class="text-[10px] font-bold uppercase text-gray-500 tracking-wider">Confirm</span>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-3xl shadow-xl border border-gray-100 overflow-hidden min-h-[450px] relative flex flex-col">
            
            <div id="step-1" class="step-content p-6 md:p-10 animate-slide-up flex-grow">
                <h2 class="text-2xl font-bold text-navy-900 mb-2 font-serif">Select Darshan Slot</h2>
                <p class="text-gray-500 text-sm mb-8">Choose a convenient date and time for your visit.</p>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Darshan Date</label>
                        <div class="relative">
                            <input type="date" id="dateInput" class="lumine-input pl-10" onchange="enableTimeSlot()">
                            <i data-lucide="calendar" class="w-5 h-5 text-orange-600 absolute left-3 top-3"></i>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Time Slot</label>
                        <div class="relative">
                            <select id="timeSlot" class="lumine-input pl-10 disabled:opacity-60" disabled>
                                <option value="">-- Select Date First --</option>
                                <option value="06:00 AM - 08:00 AM">Morning Aarti (06:00 - 08:00)</option>
                                <option value="09:00 AM - 12:00 PM">Mid-Morning (09:00 - 12:00)</option>
                                <option value="04:00 PM - 06:00 PM">Evening Darshan (16:00 - 18:00)</option>
                                <option value="07:00 PM - 08:00 PM">Evening Aarti (19:00 - 20:00)</option>
                            </select>
                            <i data-lucide="clock" class="w-5 h-5 text-orange-600 absolute left-3 top-3"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div id="step-2" class="step-content hidden p-6 md:p-10 animate-slide-up flex-grow">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-navy-900 font-serif">Add Members</h2>
                        <p class="text-gray-500 text-sm">Enter details as per Aadhaar.</p>
                    </div>
                    <button type="button" onclick="addMemberUI()" class="text-xs bg-orange-50 text-orange-700 px-3 py-2 rounded-lg font-bold hover:bg-orange-100 border border-orange-200 flex items-center gap-1 transition">
                        <i data-lucide="plus" class="w-4 h-4"></i> Add
                    </button>
                </div>
                
                <div id="membersContainer" class="space-y-4 max-h-[300px] overflow-y-auto pr-2 pb-4">
                    </div>
            </div>

            <div id="step-3" class="step-content hidden p-6 md:p-10 animate-slide-up flex-grow">
                <h2 class="text-2xl font-bold text-navy-900 mb-6 font-serif text-center">Review Booking</h2>
                
                <div class="bg-gray-50 p-6 rounded-2xl border border-gray-200 mb-6 max-w-sm mx-auto">
                    <div class="flex justify-between mb-3 pb-3 border-b border-gray-200">
                        <span class="text-gray-500 text-sm">Date</span>
                        <span class="font-bold text-navy-900" id="reviewDate">--</span>
                    </div>
                    <div class="flex justify-between mb-3 pb-3 border-b border-gray-200">
                        <span class="text-gray-500 text-sm">Time Slot</span>
                        <span class="font-bold text-orange-600" id="reviewTime">--</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-500 text-sm">Total Members</span>
                        <span class="font-bold text-navy-900" id="reviewCount">--</span>
                    </div>
                </div>

                <div class="bg-blue-50 p-4 rounded-xl border border-blue-100 flex gap-3 items-start">
                    <i data-lucide="info" class="w-5 h-5 text-blue-600 mt-0.5"></i>
                    <p class="text-xs text-blue-800 leading-relaxed">
                        Data will be verified against the UIDAI database. Please ensure all Aadhaar numbers are correct before confirming.
                    </p>
                </div>
            </div>

            <div id="successMessage" class="hidden absolute inset-0 bg-white z-50 flex flex-col items-center justify-center p-8 text-center animate-slide-up">
                <div class="relative mb-6">
                    <div class="absolute inset-0 bg-green-100 rounded-full blur-xl opacity-70"></div>
                    <div class="relative w-24 h-24 bg-green-50 text-green-600 rounded-full flex items-center justify-center border-4 border-white shadow-xl">
                        <i data-lucide="check" class="w-12 h-12"></i>
                    </div>
                </div>
                <h2 class="text-3xl font-bold text-navy-900 mb-2 font-serif">Booking Confirmed!</h2>
                <p class="text-gray-500 mt-2 mb-8 max-w-xs mx-auto">Your slot has been reserved. Data saved to local storage.</p>
                <a href="dashboard.html" class="bg-navy-900 text-white px-8 py-3.5 rounded-xl font-bold hover:bg-navy-800 transition shadow-lg flex items-center gap-2">
                    <i data-lucide="layout-grid" class="w-4 h-4"></i> Go to Dashboard
                </a>
            </div>

            <div class="p-6 bg-white border-t border-gray-100 flex justify-between items-center z-10" id="formNav">
                <button type="button" id="prevBtn" onclick="changeStep(-1)" class="px-5 py-2.5 rounded-xl text-gray-500 hover:bg-gray-50 font-semibold hidden transition">Back</button>
                <div class="flex-grow"></div>
                
                <button type="button" id="nextBtn" onclick="changeStep(1)" class="bg-orange-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-orange-700 shadow-lg shadow-orange-200 transition flex items-center gap-2">
                    Next Step <i data-lucide="arrow-right" class="w-4 h-4"></i>
                </button>
                
                <button type="button" id="submitBtn" onclick="submitToLocalDB()" class="bg-green-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-green-700 shadow-lg shadow-green-200 transition hidden flex items-center gap-2">
                    Confirm Booking <i data-lucide="check-circle" class="w-4 h-4"></i>
                </button>
            </div>
        </div>
    </main>

    <script>
        lucide.createIcons();

        // Variables
        let currentStep = 1;
        let memberCount = 0;
        const totalSteps = 3;

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            addMemberUI();
        });

        // 1. Navigation
        function changeStep(dir) {
            if(currentStep === 1 && dir === 1) {
                if(!document.getElementById('dateInput').value || !document.getElementById('timeSlot').value) {
                    alert("Please select both Date and Time."); return;
                }
            }

            document.getElementById(`step-${currentStep}`).classList.add('hidden');
            currentStep += dir;
            document.getElementById(`step-${currentStep}`).classList.remove('hidden');
            
            // Progress Bar
            const progress = ((currentStep - 1) / (totalSteps - 1)) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            
            // Update Review Info
            if(currentStep === 3) {
                document.getElementById('reviewDate').textContent = document.getElementById('dateInput').value;
                document.getElementById('reviewTime').textContent = document.getElementById('timeSlot').value;
                document.getElementById('reviewCount').textContent = document.querySelectorAll('.member-card').length + " Person(s)";
            }

            // Buttons State
            document.getElementById('prevBtn').classList.toggle('hidden', currentStep === 1);
            if(currentStep === 3) {
                document.getElementById('nextBtn').classList.add('hidden');
                document.getElementById('submitBtn').classList.remove('hidden');
            } else {
                document.getElementById('nextBtn').classList.remove('hidden');
                document.getElementById('submitBtn').classList.add('hidden');
            }
            updateStepIndicators();
        }

        function updateStepIndicators() {
            const steps = document.querySelectorAll('.step-item');
            steps.forEach((step, index) => {
                const circle = step.querySelector('.step-circle');
                step.classList.remove('step-active', 'step-completed');
                if (index < currentStep - 1) {
                    step.classList.add('step-completed');
                    circle.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i>';
                } else if (index === currentStep - 1) {
                    step.classList.add('step-active');
                    circle.textContent = index + 1;
                } else {
                    circle.textContent = index + 1;
                }
            });
            lucide.createIcons();
        }

        function enableTimeSlot() {
            document.getElementById('timeSlot').disabled = false;
        }

        // 2. MEMBER UI & DIGILOCKER LOGIC
        function addMemberUI() {
            memberCount++;
            const container = document.getElementById('membersContainer');
            const div = document.createElement('div');
            div.className = "member-card border border-gray-200 rounded-xl p-4 bg-gray-50 relative animate-slide-up mb-4";
            div.id = `member-${memberCount}`;
            
            div.innerHTML = `
                <div class="absolute -left-2 top-4 bg-navy-900 text-white text-xs w-6 h-6 flex items-center justify-center rounded-full shadow border-2 border-white font-bold">${memberCount}</div>
                ${memberCount > 1 ? `<button onclick="removeMember(${memberCount})" class="absolute top-2 right-2 text-gray-400 hover:text-red-500"><i data-lucide="x" class="w-4 h-4"></i></button>` : ''}
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 pl-2">
                    <input type="text" class="lumine-input member-name" placeholder="Full Name">
                    <input type="number" class="lumine-input member-age" placeholder="Age">
                    
                    <div class="md:col-span-2 relative aadhaar-wrapper" data-verified="false">
                         <input type="text" 
                                class="lumine-input member-aadhaar pl-10 tracking-widest font-mono transition-colors duration-300" 
                                placeholder="Enter 12-Digit Aadhaar No." 
                                maxlength="12"
                                oninput="handleAadhaarInput(this)">
                         
                         <i data-lucide="credit-card" class="w-4 h-4 text-gray-400 absolute left-3 top-3.5"></i>
                         
                         <div class="absolute right-3 top-3 status-icon"></div>
                    </div>
                    <div class="text-[10px] text-gray-400 pl-1 verification-text h-4 transition-all"></div>
                </div>
            `;
            container.appendChild(div);
            lucide.createIcons();
        }

        function removeMember(id) {
            const el = document.getElementById(`member-${id}`);
            if(el) el.remove();
        }

        // --- DIGILOCKER MOCK FUNCTION ---
        function handleAadhaarInput(input) {
            // Only numbers allowed
            input.value = input.value.replace(/[^0-9]/g, '');
            
            const wrapper = input.closest('.aadhaar-wrapper');
            const statusDiv = wrapper.querySelector('.status-icon');
            const msgDiv = wrapper.parentElement.querySelector('.verification-text');

            // Reset if user deletes
            if(input.value.length < 12) {
                wrapper.dataset.verified = "false";
                input.classList.remove('border-green-500', 'bg-green-50', 'text-green-700', 'border-orange-400');
                statusDiv.innerHTML = '';
                msgDiv.innerHTML = '';
            }

            // Trigger Verification
            if (input.value.length === 12) {
                // 1. Loading
                input.classList.add('border-orange-400');
                input.disabled = true;
                statusDiv.innerHTML = `<i data-lucide="loader-2" class="w-5 h-5 text-orange-600 loader-spin"></i>`;
                msgDiv.innerHTML = `<span class="text-orange-600 font-medium">Verifying with DigiLocker...</span>`;
                lucide.createIcons();

                // 2. Wait 2 seconds (Mock API)
                setTimeout(() => {
                    input.disabled = false;
                    input.classList.remove('border-orange-400');
                    input.classList.add('border-green-500', 'bg-green-50', 'text-green-800', 'font-bold');
                    
                    statusDiv.innerHTML = `<i data-lucide="check-circle" class="w-5 h-5 text-green-600"></i>`;
                    msgDiv.innerHTML = `<span class="text-green-600 font-bold">Verified via DigiLocker ‚úÖ</span>`;
                    wrapper.dataset.verified = "true";
                    lucide.createIcons();
                }, 2000);
            }
        }

        // 3. SAVE TO LOCAL STORAGE
        function submitToLocalDB() {
            const btn = document.getElementById('submitBtn');
            btn.innerHTML = `Saving...`;
            btn.disabled = true;

            setTimeout(() => {
                const date = document.getElementById('dateInput').value;
                const time = document.getElementById('timeSlot').value;
                const members = [];

                document.querySelectorAll('.member-card').forEach(card => {
                    const rawAadhaar = card.querySelector('.member-aadhaar').value;
                    members.push({
                        name: card.querySelector('.member-name').value || "Devotee",
                        age: card.querySelector('.member-age').value || "--",
                        aadhaar_mask: "XXXX-" + (rawAadhaar.slice(-4) || "0000"),
                        status: "Verified"
                    });
                });

                const bookingData = {
                    booking_id: "BK-" + Math.floor(100000 + Math.random() * 900000),
                    date: date,
                    time_slot: time,
                    members: members,
                    timestamp: new Date().toISOString()
                };

                localStorage.setItem('lumine_active_booking', JSON.stringify(bookingData));
                document.getElementById('formNav').classList.add('hidden');
                document.getElementById('successMessage').classList.remove('hidden');

            }, 1500);
        }
    </script>
</body>
</html>